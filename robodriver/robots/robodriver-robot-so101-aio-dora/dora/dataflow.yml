nodes:
  - id: camera_top
    build: pip install dora-camera-opencv
    path: dora-camera-opencv
    inputs:
      tick: dora/timer/millis/33
    outputs:
      - image
    env:
      VIRTUAL_ENV: ./camera.venv
      CAPTURE_PATH: 4
      IMAGE_WIDTH: 640
      IMAGE_HEIGHT: 480

  - id: camera_top_dep
    build: pip install dora-camera-opencv
    path: dora-camera-opencv
    inputs:
      tick: dora/timer/millis/33
    outputs:
      - image
    env:
      VIRTUAL_ENV: camera.venv
      CAPTURE_PATH: 2
      IMAGE_WIDTH: 640
      IMAGE_HEIGHT: 480


  - id: camera_wrist
    build: pip install dora-camera-opencv
    path: dora-camera-opencv
    inputs:
      tick: dora/timer/millis/33
    outputs:
      - image
    env:
      VIRTUAL_ENV: camera.venv
      CAPTURE_PATH: 6
      IMAGE_WIDTH: 640
      IMAGE_HEIGHT: 480

  - id: arm_so101_leader
    build: pip install dora-arm-so101
    path: dora-arm-so101
    inputs:
      get_joint: dora/timer/millis/33
    outputs:
      - joint_shoulder_pan
      - joint_shoulder_lift
      - joint_elbow_flex
      - joint_wrist_flex
      - joint_wrist_roll
      - joint_gripper
      - all_joint
    env:
      VIRTUAL_ENV: arm.venv
      GET_DEVICE_FROM: PORT
      PORT: /dev/ttyACM0
      ARM_NAME: SO101-leader
      ARM_ROLE: leader
      CALIBRATION_DIR: .calibration/

  - id: arm_so101_follower
    build: pip install dora-arm-so101
    path: dora-arm-so101
    inputs:
      get_joint: dora/timer/millis/33
      action_joint: arm_so101_leader/all_joint
      action_joint_ctrl: so101_aio_dora/action_joint
    outputs:
      - joint_shoulder_pan
      - joint_shoulder_lift
      - joint_elbow_flex
      - joint_wrist_flex
      - joint_wrist_roll
      - joint_gripper
    env:
      VIRTUAL_ENV: arm.venv
      GET_DEVICE_FROM: PORT
      PORT: /dev/ttyACM1
      ARM_NAME: SO101-follower
      ARM_ROLE: follower
      CALIBRATION_DIR: .calibration/

  - id: so101_aio_dora
    path: dynamic
    inputs:
      image_top: camera_top/image
      image_wrist: camera_wrist/image
      image_top_dep: camera_top_dep/image

      leader_joint_shoulder_pan: arm_so101_leader/joint_shoulder_pan
      leader_joint_shoulder_lift: arm_so101_leader/joint_shoulder_lift
      leader_joint_elbow_flex: arm_so101_leader/joint_elbow_flex
      leader_joint_wrist_flex: arm_so101_leader/joint_wrist_flex
      leader_joint_wrist_roll: arm_so101_leader/joint_wrist_roll
      leader_joint_gripper: arm_so101_leader/joint_gripper

      follower_joint_shoulder_pan: arm_so101_follower/joint_shoulder_pan
      follower_joint_shoulder_lift: arm_so101_follower/joint_shoulder_lift
      follower_joint_elbow_flex: arm_so101_follower/joint_elbow_flex
      follower_joint_wrist_flex: arm_so101_follower/joint_wrist_flex
      follower_joint_wrist_roll: arm_so101_follower/joint_wrist_roll
      follower_joint_gripper: arm_so101_follower/joint_gripper
    outputs:
      - action_joint
